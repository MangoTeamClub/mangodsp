<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mango短视频 - 每日精彩短视频推荐</title>
    <meta name="description" content="Mango短视频提供每日精选短视频内容，包括搞笑、音乐、游戏等各类热门视频，还有历史上的今天特色栏目。">
    <meta name="keywords" content="短视频,搞笑视频,音乐视频,游戏视频,历史今天,视频分享,Mango短视频">
    <meta name="author" content="Mango短视频">
    <meta property="og:title" content="Mango短视频 - 每日精彩短视频推荐">
    <meta property="og:description" content="每日精选短视频内容，发现生活中的精彩瞬间。">
    <meta property="og:type" content="website">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif; }
        
        html, body { height: 100%; overflow: hidden; background-color: #111; color: #fff; }
        
        .header { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background-color: rgba(0, 0, 0, 0.95); border-bottom: 2px solid #ff6600; position: sticky; top: 0; z-index: 1000; min-height: 60px; }
        .logo { display: flex; align-items: center; font-size: 20px; font-weight: bold; color: #ff6600; }
        .logo i { margin-right: 8px; font-size: 22px; }
        
        .search-container { flex: 1; max-width: 600px; margin: 0 12px; position: relative; }
        .search-input { width: 100%; padding: 10px 16px 10px 40px; border-radius: 25px; border: 2px solid #ff6600; background-color: #222; color: white; font-size: 14px; outline: none; }
        .search-input:focus { box-shadow: 0 0 10px rgba(255, 102, 0, 0.7); }
        .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #ff6600; font-size: 16px; }
        
        .search-history-dropdown { position: absolute; top: 100%; left: 0; right: 0; background-color: #222; border-radius: 0 0 15px 15px; border: 2px solid #ff6600; border-top: none; margin-top: -5px; z-index: 1001; max-height: 300px; overflow-y: auto; display: none; }
        .search-history-item { padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-bottom: 1px solid #333; }
        .search-history-item:hover { background-color: #333; }
        .clear-search-history { padding: 8px 16px; text-align: center; color: #ff6666; cursor: pointer; font-size: 13px; border-top: 1px solid #333; }
        
        .header-buttons { display: flex; gap: 12px; }
        .header-btn { background: none; border: none; color: white; font-size: 20px; cursor: pointer; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; }
        
        .main-content { flex: 1; display: flex; flex-direction: column; align-items: center; overflow-y: auto; padding: 0 10px 20px; }
        .video-container { width: 100%; max-width: 800px; margin: 10px 0; }
        .video-player { width: 100%; border-radius: 10px; overflow: hidden; background-color: #000; position: relative; aspect-ratio: 16/9; }
        video { width: 100%; height: 100%; object-fit: contain; }
        .video-info { padding: 16px; background-color: rgba(0, 0, 0, 0.85); border-radius: 0 0 10px 10px; margin-top: -5px; }
        .video-title { font-size: 18px; font-weight: 600; margin-bottom: 8px; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .video-meta { display: flex; flex-wrap: wrap; justify-content: space-between; margin-bottom: 20px; color: #aaa; font-size: 13px; gap: 8px; }
        .video-author { color: #ff6600; font-weight: 500; }
        
        .video-nav { position: absolute; left: 0; right: 0; top: 50%; transform: translateY(-50%); display: flex; justify-content: space-between; padding: 0 12px; pointer-events: none; }
        .nav-btn { background-color: rgba(255, 102, 0, 0.8); color: white; border: none; width: 44px; height: 44px; border-radius: 50%; font-size: 20px; cursor: pointer; pointer-events: all; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9); z-index: 2000; align-items: center; justify-content: center; padding: 16px; }
        .modal-content { background-color: #222; border-radius: 12px; width: 100%; max-width: 500px; max-height: 80vh; overflow: hidden; border: 2px solid #ff6600; display: flex; flex-direction: column; }
        .modal-header { padding: 18px; background-color: #ff6600; display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-size: 20px; font-weight: bold; }
        .close-btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; }
        .modal-body { padding: 20px; overflow-y: auto; flex: 1; }
        
        .share-options { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .share-option { display: flex; flex-direction: column; align-items: center; padding: 15px 10px; background-color: rgba(0, 0, 0, 0.3); border-radius: 10px; cursor: pointer; border: 1px solid transparent; }
        .share-option:hover { background-color: rgba(255, 102, 0, 0.1); border-color: rgba(255, 102, 0, 0.3); }
        .share-option-icon { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; }
        
        .floating-buttons { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; z-index: 100; }
        .floating-btn { width: 56px; height: 56px; border-radius: 50%; border: none; background: linear-gradient(135deg, #ff6600, #ff8533); color: white; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(255, 102, 0, 0.4); }
        
        .favorites-list { list-style-type: none; }
        .favorites-list li { padding: 14px; border-bottom: 1px solid #444; cursor: pointer; }
        .favorite-item { display: flex; justify-content: space-between; align-items: center; }
        .favorite-title { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; margin-right: 10px; font-size: 15px; }
        .remove-favorite { background: none; border: none; color: #ff6666; cursor: pointer; font-size: 16px; padding: 5px; }
        
        .favorites-search-container { padding: 15px 20px 0; position: relative; }
        .favorites-search-input { width: 100%; padding: 10px 16px 10px 40px; border-radius: 25px; border: 2px solid #ff6600; background-color: #333; color: white; font-size: 14px; outline: none; }
        
        .loader { display: none; text-align: center; padding: 30px; color: #ff6600; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10; }
        .video-placeholder { width: 100%; height: 100%; background-color: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #ff6600; text-align: center; padding: 20px; }
        .empty-state { text-align: center; padding: 40px 20px; color: #aaa; }
        
        .keyboard-hint { position: fixed; bottom: 20px; right: 20px; background-color: rgba(0, 0, 0, 0.7); padding: 10px 15px; border-radius: 8px; font-size: 13px; color: #aaa; border-left: 3px solid #ff6600; z-index: 100; }
        .key { display: inline-block; background-color: #333; padding: 2px 8px; border-radius: 4px; margin: 0 3px; font-family: monospace; }
        
        .history-today-container { width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: white; padding: 20px; text-align: center; }
        .history-today-icon { font-size: 60px; color: #ff6600; margin-bottom: 20px; }
        .history-today-title { font-size: 28px; font-weight: bold; margin-bottom: 10px; color: #ff6600; }
        .history-today-date { font-size: 16px; color: #aaa; margin-bottom: 30px; }
        .history-event-list { width: 100%; max-height: 300px; overflow-y: auto; text-align: left; padding: 10px; background: rgba(0, 0, 0, 0.3); border-radius: 10px; margin-bottom: 20px; }
        .history-event-item { padding: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); cursor: pointer; }
        .history-event-item:hover { background-color: rgba(255, 102, 0, 0.1); }
        .history-event-year { display: inline-block; background: #ff6600; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; margin-right: 10px; }
        .history-event-text { font-size: 14px; line-height: 1.5; }
        
        .badge { position: absolute; top: -5px; right: -5px; background-color: #ff3333; color: white; font-size: 12px; font-weight: bold; min-width: 20px; height: 20px; border-radius: 10px; display: flex; align-items: center; justify-content: center; padding: 0 5px; }
        
        @media (max-width: 768px) {
            .header { padding: 10px 12px; }
            .logo { font-size: 18px; }
            .search-container { margin: 0 8px; }
            .search-input { padding: 8px 14px 8px 36px; font-size: 13px; }
            .header-btn { width: 36px; height: 36px; }
            .video-title { font-size: 16px; -webkit-line-clamp: 3; }
            .video-meta { font-size: 12px; margin-bottom: 15px; }
            .keyboard-hint { display: none; }
            .share-options { grid-template-columns: repeat(2, 1fr); gap: 12px; }
            .floating-buttons { bottom: 15px; gap: 10px; }
            .floating-btn { width: 50px; height: 50px; font-size: 18px; }
        }
        
        @media (max-width: 480px) {
            .header { padding: 8px 10px; }
            .logo { font-size: 16px; }
            .search-input { padding: 8px 12px 8px 34px; font-size: 12px; }
            .video-title { font-size: 15px; }
            .video-meta { flex-direction: column; gap: 4px; margin-bottom: 12px; }
            .share-options { grid-template-columns: repeat(2, 1fr); gap: 10px; }
            .share-option-icon { width: 40px; height: 40px; font-size: 20px; }
            .floating-buttons { bottom: 10px; gap: 8px; }
            .floating-btn { width: 46px; height: 46px; font-size: 17px; }
        }
        
        @media (max-width: 360px) {
            .logo span { display: none; }
            .logo i { margin-right: 0; }
            .search-input { padding-left: 32px; }
            .video-title { font-size: 14px; }
            .floating-buttons { bottom: 8px; gap: 6px; }
            .floating-btn { width: 44px; height: 44px; font-size: 16px; }
        }
        
        body { display: flex; flex-direction: column; }
        .modal-body::-webkit-scrollbar { width: 6px; }
        .modal-body::-webkit-scrollbar-track { background: #333; }
        .modal-body::-webkit-scrollbar-thumb { background: #ff6600; }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <i class="fas fa-play-circle"></i>
            <span>Mango短视频</span>
        </div>
        
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" class="search-input" id="searchInput" placeholder="搜索视频..." autocomplete="off">
            <div class="search-history-dropdown" id="searchHistoryDropdown"></div>
        </div>
        
        <div class="header-buttons">
            <button class="header-btn" id="aboutBtn" title="关于">
                <i class="fas fa-info-circle"></i>
            </button>
            <button class="header-btn" id="favoritesBtn" title="收藏夹">
                <i class="fas fa-heart"></i>
            </button>
        </div>
    </header>

    <main class="main-content" id="mainContent">
        <div class="video-container">
            <div class="video-player" id="videoPlayer">
                <div class="video-placeholder" id="videoPlaceholder">
                    <i class="fas fa-play-circle"></i>
                    <p>输入关键词搜索视频</p>
                    <p style="font-size:14px;margin-top:10px;color:#aaa;">加载中</p>
                </div>
                <video id="videoElement" controls style="display:none;">
                    <source id="videoSource" src="" type="video/mp4">
                    您的浏览器不支持视频播放
                </video>
                
                <div class="history-today-container" id="historyTodayContainer" style="display:none;">
                    <div class="history-today-icon">
                        <i class="fas fa-history"></i>
                    </div>
                    <div class="history-today-title" id="historyTodayTitle">历史上的今天</div>
                    <div class="history-today-date" id="historyTodayDate">12月11日</div>
                    <div class="history-event-list" id="historyEventList"></div>
                    <div class="history-today-footer">
                        <p>Mango短视频官方 · 每日更新</p>
                        <p style="margin-top:5px;font-size:11px;color:#666;">点击历史事件可搜索相关视频</p>
                    </div>
                </div>
                
                <div class="video-nav">
                    <button class="nav-btn" id="prevBtn" title="上一个视频">
                        <i class="fas fa-chevron-up"></i>
                    </button>
                    <button class="nav-btn" id="nextBtn" title="下一个视频">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
            </div>
            
            <div class="video-info" id="videoInfo" style="display:none;">
                <div class="video-title" id="videoTitle">视频标题</div>
                <div class="video-meta">
                    <div>作者: <span class="video-author" id="videoAuthor">作者名称</span></div>
                    <div>播放量: <span id="videoPlayCount">0</span></div>
                    <div>发布时间: <span id="videoPublishTime">刚刚</span></div>
                </div>
            </div>
        </div>
        
        <div class="loader" id="loader">
            <i class="fas fa-spinner fa-spin"></i>
            <p>加载中...</p>
        </div>
        
        <div class="keyboard-hint" id="keyboardHint">
            使用 <span class="key">↑</span> <span class="key">↓</span> 键或滚轮切换视频
        </div>
    </main>

    <div class="floating-buttons" id="floatingButtons">
        <button class="floating-btn" id="floatingFavoriteBtn" title="收藏">
            <i class="fas fa-heart"></i>
        </button>
        <button class="floating-btn share" id="floatingShareBtn" title="分享">
            <i class="fas fa-share"></i>
        </button>
    </div>

    <div class="modal" id="aboutModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">关于 Mango短视频</div>
                <button class="close-btn" id="closeAboutBtn">&times;</button>
            </div>
            <div class="modal-body">
                <p>Mango短视频是一个基于B站视频资源的短视频播放应用。</p>
                <p><strong>声明：</strong>本应用提供的所有视频内容均来源于网络，仅用于学习和娱乐目的。</p>
                <p>请尊重视频原作者的知识产权，如需商业使用请联系版权所有者。</p>
                <p>本应用不存储任何视频内容，所有视频均通过API接口实时获取。</p>
            </div>
            <div class="modal-footer">
                ©2022-2026 Mango短视频 版权所有
            </div>
        </div>
    </div>

    <div class="modal" id="favoritesModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">我的收藏夹</div>
                <button class="close-btn" id="closeFavoritesBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="favorites-search-container">
                    <i class="fas fa-search favorites-search-icon"></i>
                    <input type="text" class="favorites-search-input" id="favoritesSearchInput" placeholder="搜索收藏的视频...">
                </div>
                
                <ul class="favorites-list" id="favoritesList"></ul>
                <div class="empty-state" id="emptyFavorites" style="display:none;">
                    <i class="fas fa-heart-broken"></i>
                    <p>收藏夹为空</p>
                    <p>收藏的视频将显示在这里</p>
                </div>
                <div class="empty-state" id="noSearchResults" style="display:none;">
                    <i class="fas fa-search"></i>
                    <p>未找到匹配的收藏</p>
                    <p>尝试其他搜索关键词</p>
                </div>
            </div>
            <div class="modal-footer">
                点击视频名称即可播放
            </div>
        </div>
    </div>

    <div class="modal" id="shareModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">分享视频</div>
                <button class="close-btn" id="closeShareBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="share-content" id="shareContent"></div>
            </div>
            <div class="modal-footer">
                选择一种方式分享
            </div>
        </div>
    </div>

    <script>
        let currentVideoList = [];
        let currentVideoIndex = 0;
        let currentSearchKeyword = '';
        let favorites = JSON.parse(localStorage.getItem('mangoFavorites')) || [];
        let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        let isRecommendationMode = true;
        let recommendationCount = 0;
        let currentRecommendationIndex = 0;
        const recommendations = ['搞笑', '猫meme', '抽象', '音乐', '游戏','我的世界','电影','编程'];
        
        let todayHistoryLoaded = false;
        let todayHistoryData = null;
        let historyTodayPosition = Math.random() < 0.5 ? 1 : 2;
        let historyTodayInserted = false;
        
        let searchHistory = JSON.parse(localStorage.getItem('mangoSearchHistory')) || [];
        const MAX_SEARCH_HISTORY = 10;
        
        const searchInput = document.getElementById('searchInput');
        const videoElement = document.getElementById('videoElement');
        const videoSource = document.getElementById('videoSource');
        const videoPlaceholder = document.getElementById('videoPlaceholder');
        const videoInfo = document.getElementById('videoInfo');
        const videoTitle = document.getElementById('videoTitle');
        const videoAuthor = document.getElementById('videoAuthor');
        const videoPlayCount = document.getElementById('videoPlayCount');
        const videoPublishTime = document.getElementById('videoPublishTime');
        const mainContent = document.getElementById('mainContent');
        const loader = document.getElementById('loader');
        const aboutBtn = document.getElementById('aboutBtn');
        const favoritesBtn = document.getElementById('favoritesBtn');
        const aboutModal = document.getElementById('aboutModal');
        const favoritesModal = document.getElementById('favoritesModal');
        const shareModal = document.getElementById('shareModal');
        const closeAboutBtn = document.getElementById('closeAboutBtn');
        const closeFavoritesBtn = document.getElementById('closeFavoritesBtn');
        const closeShareBtn = document.getElementById('closeShareBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const keyboardHint = document.getElementById('keyboardHint');
        
        const historyTodayContainer = document.getElementById('historyTodayContainer');
        const historyTodayTitle = document.getElementById('historyTodayTitle');
        const historyTodayDate = document.getElementById('historyTodayDate');
        const historyEventList = document.getElementById('historyEventList');
        
        const searchHistoryDropdown = document.getElementById('searchHistoryDropdown');
        const favoritesSearchInput = document.getElementById('favoritesSearchInput');
        const noSearchResults = document.getElementById('noSearchResults');
        
        const floatingButtons = document.getElementById('floatingButtons');
        const floatingFavoriteBtn = document.getElementById('floatingFavoriteBtn');
        const floatingShareBtn = document.getElementById('floatingShareBtn');
        
        document.addEventListener('DOMContentLoaded', function() {
            if (isMobile) {
                keyboardHint.style.display = 'none';
            }
            
            updateSearchHistoryDisplay();
            
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    isRecommendationMode = false;
                    recommendationCount = 0;
                    historyTodayInserted = false;
                    searchVideos();
                }
            });
            
            searchInput.addEventListener('focus', function() {
                if (searchHistory.length > 0) {
                    searchHistoryDropdown.style.display = 'block';
                }
            });
            
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.search-container')) {
                    searchHistoryDropdown.style.display = 'none';
                }
            });
            
            aboutBtn.addEventListener('click', () => showModal(aboutModal));
            favoritesBtn.addEventListener('click', () => {
                renderFavorites();
                showModal(favoritesModal);
            });
            
            closeAboutBtn.addEventListener('click', () => hideModal(aboutModal));
            closeFavoritesBtn.addEventListener('click', () => hideModal(favoritesModal));
            closeShareBtn.addEventListener('click', () => hideModal(shareModal));
            
            window.addEventListener('click', function(e) {
                if (e.target === aboutModal) hideModal(aboutModal);
                if (e.target === favoritesModal) hideModal(favoritesModal);
                if (e.target === shareModal) hideModal(shareModal);
            });
            
            floatingFavoriteBtn.addEventListener('click', toggleFavorite);
            prevBtn.addEventListener('click', prevVideo);
            nextBtn.addEventListener('click', nextVideo);
            floatingShareBtn.addEventListener('click', openShareModal);
            
            if (!isMobile) {
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
                        e.preventDefault();
                        if (e.key === 'ArrowUp') prevVideo();
                        if (e.key === 'ArrowDown') nextVideo();
                    }
                    
                    if (e.key === 'Escape') {
                        hideModal(aboutModal);
                        hideModal(favoritesModal);
                        hideModal(shareModal);
                    }
                    
                    if (e.key === 'f' || e.key === 'F') {
                        toggleFavorite();
                    }
                    
                    if (e.key === 's' || e.key === 'S') {
                        openShareModal();
                    }
                });
                
                mainContent.addEventListener('wheel', function(e) {
                    if (e.deltaY !== 0 && currentVideoList.length > 0) {
                        e.preventDefault();
                        if (e.deltaY > 0) nextVideo();
                        else prevVideo();
                    }
                }, { passive: false });
            }
            
            if (isMobile) {
                let touchStartY = 0;
                let touchEndY = 0;
                
                mainContent.addEventListener('touchstart', function(e) {
                    touchStartY = e.changedTouches[0].screenY;
                }, { passive: true });
                
                mainContent.addEventListener('touchend', function(e) {
                    touchEndY = e.changedTouches[0].screenY;
                    handleSwipe();
                }, { passive: true });
                
                function handleSwipe() {
                    const swipeThreshold = 50;
                    const swipeDistance = touchStartY - touchEndY;
                    
                    if (Math.abs(swipeDistance) > swipeThreshold) {
                        if (swipeDistance > 0) {
                            nextVideo();
                        } else {
                            prevVideo();
                        }
                    }
                }
            }
            
            favoritesSearchInput.addEventListener('input', function() {
                filterFavorites(this.value);
            });
            
            loadNextRecommendation();
            window.addEventListener('resize', adjustLayout);
            adjustLayout();
            loadHistoryTodayData();
            initFloatingButtons();
        });
        
        function initFloatingButtons() {
            adjustFloatingButtons();
            
            let lastScrollTop = 0;
            mainContent.addEventListener('scroll', function() {
                const scrollTop = mainContent.scrollTop;
                const delta = scrollTop - lastScrollTop;
                
                if (Math.abs(delta) > 10) {
                    if (delta > 0) {
                        floatingButtons.style.transform = 'translateX(-50%) translateY(100px)';
                        floatingButtons.style.opacity = '0.3';
                    } else {
                        floatingButtons.style.transform = 'translateX(-50%) translateY(0)';
                        floatingButtons.style.opacity = '1';
                    }
                }
                
                lastScrollTop = scrollTop;
            });
        }
        
        function adjustFloatingButtons() {
            const videoContainer = document.querySelector('.video-container');
            if (videoContainer) {
                const rect = videoContainer.getBoundingClientRect();
                const windowHeight = window.innerHeight;
                
                if (rect.bottom > windowHeight / 2) {
                    floatingButtons.style.bottom = '20px';
                } else {
                    floatingButtons.style.bottom = '20px';
                }
            }
        }
        
        function adjustLayout() {
            const headerHeight = document.querySelector('.header').offsetHeight;
            const windowHeight = window.innerHeight;
            mainContent.style.height = (windowHeight - headerHeight) + 'px';
            adjustFloatingButtons();
        }
        
        function showModal(modal) {
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        function hideModal(modal) {
            modal.style.display = 'none';
            document.body.style.overflow = '';
        }
        
        async function searchVideos() {
            const keyword = searchInput.value.trim();
            if (!keyword) return;
            
            currentSearchKeyword = keyword;
            showLoader();
            
            if (isMobile) {
                searchInput.blur();
            }
            
            addToSearchHistory(keyword);
            
            try {
                const response = await fetch(`https://api.jkyai.top/API/bilibilijx.php?msg=${encodeURIComponent(keyword)}`);
                const data = await response.json();
                
                if (data.success && data.data && data.data.length > 0) {
                    currentVideoList = data.data;
                    currentVideoIndex = 0;
                    await loadVideoByIndex(0);
                } else {
                    hideLoader();
                    alert('未找到相关视频，请尝试其他关键词');
                }
            } catch (error) {
                hideLoader();
                alert('搜索失败，请检查网络连接');
            }
        }
        
        async function loadNextRecommendation() {
            if (!isRecommendationMode) return;
            
            const keyword = recommendations[currentRecommendationIndex];
            currentRecommendationIndex = (currentRecommendationIndex + 1) % recommendations.length;
            
            searchInput.value = keyword;
            currentSearchKeyword = keyword;
            
            recommendationCount = 0;
            historyTodayInserted = false;
            
            showLoader();
            
            try {
                const response = await fetch(`https://api.jkyai.top/API/bilibilijx.php?msg=${encodeURIComponent(keyword)}`);
                const data = await response.json();
                
                if (data.success && data.data && data.data.length > 0) {
                    currentVideoList = data.data;
                    currentVideoIndex = 0;
                    insertHistoryTodayIntoList();
                    await loadVideoByIndex(0);
                } else {
                    hideLoader();
                    setTimeout(loadNextRecommendation, 1000);
                }
            } catch (error) {
                hideLoader();
                setTimeout(loadNextRecommendation, 1000);
            }
        }
        
        function insertHistoryTodayIntoList() {
            if (todayHistoryLoaded && !historyTodayInserted && isRecommendationMode && todayHistoryData) {
                const historyTodayVideo = {
                    isHistoryToday: true,
                    title: "历史上的今天",
                    author: "Mango短视频官方",
                    play_count: "0",
                    publish_time: getHoursAgoText(),
                    history_data: todayHistoryData
                };
                
                const insertPosition = Math.min(historyTodayPosition, currentVideoList.length);
                currentVideoList.splice(insertPosition, 0, historyTodayVideo);
                historyTodayInserted = true;
            }
        }
        
        async function loadVideoByIndex(index) {
            if (index < 0 || index >= currentVideoList.length) return;
            
            currentVideoIndex = index;
            const video = currentVideoList[index];
            
            if (video.isHistoryToday) {
                loadHistoryTodayVideo(video);
                return;
            }
            
            updateVideoInfo(video);
            updateFavoriteButton(video);
            showLoader();
            
            try {
                const response = await fetch(`https://api.jkyai.top/API/bilibilijx.php?msg=${encodeURIComponent(currentSearchKeyword)}&n=${index + 1}`);
                const data = await response.json();
                
                if (data.success && data.data && data.data.video_url) {
                    videoSource.src = data.data.video_url;
                    videoElement.load();
                    
                    videoPlaceholder.style.display = 'none';
                    historyTodayContainer.style.display = 'none';
                    videoElement.style.display = 'block';
                    videoInfo.style.display = 'block';
                    
                    videoElement.play().catch(e => {});
                    
                    mainContent.scrollTo(0, 0);
                } else {
                    throw new Error('无法获取视频URL');
                }
            } catch (error) {
                videoPlaceholder.innerHTML = `
                    <div>
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>视频加载失败</p>
                        <p style="font-size:14px;margin-top:10px;color:#aaa;">${error.message || '请检查网络连接'}</p>
                    </div>
                `;
                videoPlaceholder.style.display = 'flex';
                videoElement.style.display = 'none';
                historyTodayContainer.style.display = 'none';
                videoInfo.style.display = 'block';
            } finally {
                hideLoader();
            }
        }
        
        async function loadHistoryTodayData() {
            try {
                const now = new Date();
                const month = (now.getMonth() + 1).toString().padStart(2, '0');
                const day = now.getDate().toString().padStart(2, '0');
                const dateStr = month + day;
                
                const response = await fetch(`https://api.jkyai.top/API/lssdjt.php?time=${dateStr}`);
                const data = await response.json();
                
                if (data.code === 200 && data.data && data.data.events && data.data.events.length > 0) {
                    todayHistoryData = data.data.events;
                    todayHistoryLoaded = true;
                    historyTodayDate.textContent = `${month}月${day}日`;
                }
            } catch (error) {
                console.error('加载历史今天数据出错:', error);
            }
        }
        
        function loadHistoryTodayVideo(video) {
            videoPlaceholder.style.display = 'none';
            videoElement.style.display = 'none';
            historyTodayContainer.style.display = 'flex';
            videoInfo.style.display = 'block';
            
            videoTitle.textContent = "历史上的今天";
            videoAuthor.textContent = "Mango短视频官方";
            videoPlayCount.textContent = "0";
            videoPublishTime.textContent = getHoursAgoText();
            
            updateFavoriteButton(video);
            renderHistoryEvents(video.history_data || todayHistoryData);
            mainContent.scrollTo(0, 0);
            hideLoader();
        }
        
        function renderHistoryEvents(events) {
            if (!events || events.length === 0) {
                historyEventList.innerHTML = '<div class="history-event-item">暂无历史事件数据</div>';
                return;
            }
            
            const eventsToShow = events.slice(0, 8);
            historyEventList.innerHTML = '';
            eventsToShow.forEach(event => {
                const item = document.createElement('div');
                item.className = 'history-event-item';
                item.innerHTML = `
                    <span class="history-event-year">${event.year}</span>
                    <span class="history-event-text">${event.event}</span>
                `;
                
                item.addEventListener('click', function() {
                    const eventText = event.event.replace(/^\d+年\d+月\d+日\s*/, '');
                    searchFromHistoryEvent(eventText);
                });
                
                historyEventList.appendChild(item);
            });
        }
        
        function searchFromHistoryEvent(eventText) {
            searchInput.value = eventText;
            currentSearchKeyword = eventText;
            
            isRecommendationMode = false;
            recommendationCount = 0;
            historyTodayInserted = false;
            
            addToSearchHistory(eventText);
            searchVideos();
        }
        
        function getHoursAgoText() {
            const now = new Date();
            const hours = now.getHours();
            return `${hours}小时前`;
        }
        
        function updateVideoInfo(video) {
            videoTitle.textContent = video.title;
            videoAuthor.textContent = video.author;
            videoPlayCount.textContent = video.play_count || "0";
            videoPublishTime.textContent = video.publish_time || "刚刚";
        }
        
        function updateFavoriteButton(video) {
            const isFavorited = favorites.some(fav => {
                if (video.isHistoryToday) {
                    return fav.title === "历史上的今天" && fav.author === "Mango短视频官方";
                } else {
                    return fav.title === video.title && fav.author === video.author;
                }
            });
            
            if (isFavorited) {
                floatingFavoriteBtn.style.background = 'linear-gradient(135deg, #ff3333, #ff6666)';
            } else {
                floatingFavoriteBtn.style.background = 'linear-gradient(135deg, #ff6600, #ff8533)';
            }
        }
        
        function toggleFavorite() {
            const currentVideo = currentVideoList[currentVideoIndex];
            if (!currentVideo) return;
            
            const isHistoryToday = currentVideo.isHistoryToday;
            
            let index;
            if (isHistoryToday) {
                index = favorites.findIndex(fav => 
                    fav.title === "历史上的今天" && fav.author === "Mango短视频官方");
            } else {
                index = favorites.findIndex(fav => 
                    fav.title === currentVideo.title && fav.author === currentVideo.author);
            }
            
            if (index === -1) {
                if (isHistoryToday) {
                    favorites.push({
                        title: "历史上的今天",
                        author: "Mango短视频官方",
                        play_count: "0",
                        publish_time: getHoursAgoText(),
                        isHistoryToday: true,
                        history_data: currentVideo.history_data || todayHistoryData
                    });
                } else {
                    favorites.push({
                        ...currentVideo,
                        keyword: currentSearchKeyword,
                        index: currentVideoIndex
                    });
                }
                
                floatingFavoriteBtn.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    floatingFavoriteBtn.style.transform = 'scale(1)';
                }, 200);
            } else {
                favorites.splice(index, 1);
            }
            
            localStorage.setItem('mangoFavorites', JSON.stringify(favorites));
            updateFavoriteButton(currentVideo);
            
            if (favoritesModal.style.display === 'flex') {
                renderFavorites();
            }
        }
        
        function renderFavorites() {
            favoritesList.innerHTML = '';
            
            if (favorites.length === 0) {
                emptyFavorites.style.display = 'block';
                noSearchResults.style.display = 'none';
                return;
            }
            
            emptyFavorites.style.display = 'none';
            
            const searchTerm = favoritesSearchInput.value.trim().toLowerCase();
            let hasResults = false;
            
            favorites.forEach((fav, index) => {
                if (searchTerm) {
                    const title = (fav.isHistoryToday ? "历史上的今天" : fav.title).toLowerCase();
                    const author = (fav.isHistoryToday ? "Mango短视频官方" : fav.author).toLowerCase();
                    
                    if (!title.includes(searchTerm) && !author.includes(searchTerm)) {
                        return;
                    }
                }
                
                hasResults = true;
                
                const li = document.createElement('li');
                
                if (fav.isHistoryToday) {
                    li.innerHTML = `
                        <div class="favorite-item">
                            <div class="favorite-title" title="历史上的今天">历史上的今天</div>
                            <button class="remove-favorite" data-index="${index}" title="移除收藏">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div style="font-size:12px;color:#aaa;margin-top:5px;">
                            作者: Mango短视频官方 | 发布时间: ${fav.publish_time || getHoursAgoText()}
                        </div>
                    `;
                } else {
                    li.innerHTML = `
                        <div class="favorite-item">
                            <div class="favorite-title" title="${fav.title}">${fav.title}</div>
                            <button class="remove-favorite" data-index="${index}" title="移除收藏">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div style="font-size:12px;color:#aaa;margin-top:5px;">
                            作者: ${fav.author} | 发布时间: ${fav.publish_time}
                        </div>
                    `;
                }
                
                li.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('remove-favorite') && 
                        !e.target.parentElement.classList.contains('remove-favorite')) {
                        playFavorite(fav, index);
                        hideModal(favoritesModal);
                    }
                });
                
                const removeBtn = li.querySelector('.remove-favorite');
                removeBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    removeFavorite(index);
                });
                
                favoritesList.appendChild(li);
            });
            
            if (!hasResults && searchTerm) {
                noSearchResults.style.display = 'block';
            } else {
                noSearchResults.style.display = 'none';
            }
        }
        
        function filterFavorites(searchTerm) {
            renderFavorites();
        }
        
        async function playFavorite(fav, favIndex) {
            if (fav.isHistoryToday) {
                const historyTodayVideo = {
                    isHistoryToday: true,
                    title: "历史上的今天",
                    author: "Mango短视频官方",
                    play_count: "0",
                    publish_time: getHoursAgoText(),
                    history_data: fav.history_data || todayHistoryData
                };
                
                currentVideoList = [historyTodayVideo];
                currentVideoIndex = 0;
                currentSearchKeyword = "历史上的今天";
                searchInput.value = "历史上的今天";
                isRecommendationMode = false;
                
                loadHistoryTodayVideo(historyTodayVideo);
                return;
            }
            
            searchInput.value = fav.keyword || fav.title.substring(0, 20);
            currentSearchKeyword = fav.keyword || fav.title.substring(0, 20);
            
            isRecommendationMode = false;
            historyTodayInserted = false;
            
            showLoader();
            
            try {
                const response = await fetch(`https://api.jkyai.top/API/bilibilijx.php?msg=${encodeURIComponent(currentSearchKeyword)}`);
                const data = await response.json();
                
                if (data.success && data.data && data.data.length > 0) {
                    currentVideoList = data.data;
                    
                    const videoIndex = currentVideoList.findIndex(v => 
                        v.title === fav.title && v.author === fav.author);
                    
                    if (videoIndex !== -1) {
                        currentVideoIndex = videoIndex;
                        await loadVideoByIndex(videoIndex);
                    } else {
                        currentVideoIndex = 0;
                        await loadVideoByIndex(0);
                    }
                }
            } catch (error) {
                alert('无法加载收藏的视频');
                hideLoader();
            }
        }
        
        function removeFavorite(index) {
            favorites.splice(index, 1);
            localStorage.setItem('mangoFavorites', JSON.stringify(favorites));
            renderFavorites();
            
            const currentVideo = currentVideoList[currentVideoIndex];
            if (currentVideo) {
                updateFavoriteButton(currentVideo);
            }
        }
        
        function prevVideo() {
            if (currentVideoList.length === 0) return;
            
            let newIndex = currentVideoIndex - 1;
            if (newIndex < 0) newIndex = currentVideoList.length - 1;
            
            loadVideoByIndex(newIndex);
        }
        
        function nextVideo() {
            if (currentVideoList.length === 0) return;
            
            if (isRecommendationMode) {
                recommendationCount++;
                
                if (recommendationCount >= 5) {
                    loadNextRecommendation();
                    return;
                }
            }
            
            let newIndex = currentVideoIndex + 1;
            if (newIndex >= currentVideoList.length) newIndex = 0;
            
            loadVideoByIndex(newIndex);
        }
        
        function showLoader() {
            loader.style.display = 'block';
        }
        
        function hideLoader() {
            loader.style.display = 'none';
        }
        
        function openShareModal() {
            const currentVideo = currentVideoList[currentVideoIndex];
            if (!currentVideo) return;
            
            renderShareContent(currentVideo);
            showModal(shareModal);
        }
        
        function renderShareContent(video) {
            const isHistoryToday = video.isHistoryToday;
            const videoUrl = window.location.href;
            
            let shareText = '';
            let shareTitle = '';
            
            if (isHistoryToday) {
                const now = new Date();
                const month = (now.getMonth() + 1).toString().padStart(2, '0');
                const day = now.getDate().toString().padStart(2, '0');
                shareText = `我正在Mango短视频查看历史上的今天(${month}月${day}日)，快来一起看看吧！`;
                shareTitle = '历史上的今天 - Mango短视频';
            } else {
                shareText = `我正在Mango短视频观看《${video.title}》 - 作者: ${video.author}，推荐给你！`;
                shareTitle = `${video.title} - Mango短视频`;
            }
            
            let contentHTML = `
                <div class="share-video-info">
                    <div class="share-video-title">${isHistoryToday ? '历史上的今天' : video.title}</div>
                    <div class="share-video-meta">
                        <div>作者: ${isHistoryToday ? 'Mango短视频官方' : video.author}</div>
                        <div>${isHistoryToday ? '每日更新' : `播放量: ${video.play_count || '0'}`}</div>
                    </div>
                </div>
                
                <div class="share-options">
                    <div class="share-option" id="copyUrlBtn" title="复制链接">
                        <div class="share-option-icon" style="background:linear-gradient(135deg,#4CAF50,#2E7D32);">
                            <i class="fas fa-link"></i>
                        </div>
                        <div class="share-option-text">复制链接</div>
                    </div>
                    
                    <div class="share-option" id="copyTextBtn" title="复制分享文本">
                        <div class="share-option-icon" style="background:linear-gradient(135deg,#4CAF50,#2E7D32);">
                            <i class="fas fa-copy"></i>
                        </div>
                        <div class="share-option-text">复制文案</div>
                    </div>
                    
                    <div class="share-option" id="systemShareBtn" title="系统分享">
                        <div class="share-option-icon" style="background:linear-gradient(135deg,#FF9800,#F57C00);">
                            <i class="fas fa-share-alt"></i>
                        </div>
                        <div class="share-option-text">系统分享</div>
                    </div>
                    
                    <div class="share-option" id="wechatShareBtn" title="分享到微信">
                        <div class="share-option-icon" style="background:linear-gradient(135deg,#09BB07,#09A306);">
                            <i class="fab fa-weixin"></i>
                        </div>
                        <div class="share-option-text">微信分享</div>
                    </div>
                    
                    <div class="share-option" id="qqShareBtn" title="分享到QQ">
                        <div class="share-option-icon" style="background:linear-gradient(135deg,#12B7F5,#0099CC);">
                            <i class="fab fa-qq"></i>
                        </div>
                        <div class="share-option-text">QQ分享</div>
                    </div>
                    
                    <div class="share-option" id="weiboShareBtn" title="分享到微博">
                        <div class="share-option-icon" style="background:linear-gradient(135deg,#E6162D,#D50F26);">
                            <i class="fab fa-weibo"></i>
                        </div>
                        <div class="share-option-text">微博分享</div>
                    </div>
                </div>
                
                <div class="share-url-container">
                    <div class="share-url-label">分享链接:</div>
                    <div class="share-url-box">
                        <input type="text" class="share-url-input" id="shareUrlInput" value="${videoUrl}" readonly>
                        <button class="share-url-copy-btn" id="shareUrlCopyBtn">复制</button>
                    </div>
                </div>
                
                <div class="share-message">
                    分享给好友，一起观看精彩视频！
                </div>
            `;
            
            shareContent.innerHTML = contentHTML;
            
            const copyUrlBtn = document.getElementById('copyUrlBtn');
            const shareUrlInput = document.getElementById('shareUrlInput');
            const shareUrlCopyBtn = document.getElementById('shareUrlCopyBtn');
            const copyTextBtn = document.getElementById('copyTextBtn');
            const systemShareBtn = document.getElementById('systemShareBtn');
            const wechatShareBtn = document.getElementById('wechatShareBtn');
            const qqShareBtn = document.getElementById('qqShareBtn');
            const weiboShareBtn = document.getElementById('weiboShareBtn');
            
            copyUrlBtn.addEventListener('click', function() {
                copyToClipboard(videoUrl, '链接');
            });
            
            shareUrlCopyBtn.addEventListener('click', function() {
                copyToClipboard(videoUrl, '链接');
                shareUrlCopyBtn.textContent = '已复制';
                setTimeout(() => {
                    shareUrlCopyBtn.textContent = '复制';
                }, 2000);
            });
            
            copyTextBtn.addEventListener('click', function() {
                copyToClipboard(shareText, '分享文案');
            });
            
            systemShareBtn.addEventListener('click', function() {
                if (navigator.share) {
                    navigator.share({
                        title: shareTitle,
                        text: shareText,
                        url: videoUrl
                    }).catch(err => {
                        console.log('分享取消或出错:', err);
                    });
                } else {
                    alert('您的浏览器不支持系统分享功能，已为您复制分享文案到剪贴板');
                    copyToClipboard(shareText, '分享文案');
                }
            });
            
            wechatShareBtn.addEventListener('click', function() {
                alert('微信分享功能需要接入微信SDK，这里已为您复制分享文案到剪贴板');
                copyToClipboard(shareText, '分享文案');
            });
            
            qqShareBtn.addEventListener('click', function() {
                alert('QQ分享功能需要接入QQ SDK，这里已为您复制分享文案到剪贴板');
                copyToClipboard(shareText, '分享文案');
            });
            
            weiboShareBtn.addEventListener('click', function() {
                const weiboUrl = `https://service.weibo.com/share/share.php?title=${encodeURIComponent(shareText)}&url=${encodeURIComponent(videoUrl)}`;
                window.open(weiboUrl, '_blank', 'width=600,height=400');
            });
        }
        
        function copyToClipboard(text, type = '内容') {
            navigator.clipboard.writeText(text).then(() => {
                showCopySuccessMessage(type);
            }).catch(err => {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                
                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        showCopySuccessMessage(type);
                    } else {
                        alert(`复制${type}失败，请手动复制:\n\n${text}`);
                    }
                } catch (err) {
                    alert(`复制${type}失败，请手动复制:\n\n${text}`);
                }
                
                document.body.removeChild(textarea);
            });
        }
        
        function showCopySuccessMessage(type) {
            const message = document.createElement('div');
            message.textContent = `${type}已复制到剪贴板`;
            message.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                z-index: 3000;
                font-size: 16px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
                animation: fadeInOut 2s ease-in-out;
            `;
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeInOut {
                    0% { opacity: 0; }
                    15% { opacity: 1; }
                    85% { opacity: 1; }
                    100% { opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            document.body.appendChild(message);
            
            setTimeout(() => {
                document.body.removeChild(message);
                document.head.removeChild(style);
            }, 2000);
        }
        
        window.addEventListener('orientationchange', function() {
            setTimeout(adjustLayout, 300);
        });
        
        function addToSearchHistory(keyword) {
            searchHistory = searchHistory.filter(item => item.keyword !== keyword);
            
            searchHistory.unshift({
                keyword: keyword,
                time: new Date().toLocaleString('zh-CN', { 
                    month: '2-digit', 
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                })
            });
            
            if (searchHistory.length > MAX_SEARCH_HISTORY) {
                searchHistory = searchHistory.slice(0, MAX_SEARCH_HISTORY);
            }
            
            localStorage.setItem('mangoSearchHistory', JSON.stringify(searchHistory));
            updateSearchHistoryDisplay();
        }
        
        function updateSearchHistoryDisplay() {
            const dropdown = document.getElementById('searchHistoryDropdown');
            
            if (searchHistory.length === 0) {
                dropdown.innerHTML = '<div class="search-history-item">暂无搜索历史</div>';
                return;
            }
            
            let html = '';
            
            searchHistory.forEach((item, index) => {
                html += `
                    <div class="search-history-item" data-keyword="${item.keyword}">
                        <div class="search-history-text">${item.keyword}</div>
                        <div class="search-history-time">${item.time}</div>
                    </div>
                `;
            });
            
            html += `<div class="clear-search-history" id="clearSearchHistory">清除搜索历史</div>`;
            
            dropdown.innerHTML = html;
            
            const historyItems = dropdown.querySelectorAll('.search-history-item');
            historyItems.forEach(item => {
                const keyword = item.getAttribute('data-keyword');
                if (keyword) {
                    item.addEventListener('click', function() {
                        searchInput.value = keyword;
                        currentSearchKeyword = keyword;
                        
                        isRecommendationMode = false;
                        recommendationCount = 0;
                        historyTodayInserted = false;
                        
                        searchHistoryDropdown.style.display = 'none';
                        searchVideos();
                    });
                }
            });
            
            const clearBtn = document.getElementById('clearSearchHistory');
            if (clearBtn) {
                clearBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    clearSearchHistory();
                });
            }
        }
        
        function clearSearchHistory() {
            if (confirm('确定要清除所有搜索历史吗？')) {
                searchHistory = [];
                localStorage.setItem('mangoSearchHistory', JSON.stringify(searchHistory));
                updateSearchHistoryDisplay();
            }
        }
    </script>
</body>
</html>
